<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-orange.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-orange.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-orange.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"orangexc.xyz","root":"/","scheme":"Pisces","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="浅谈前端测试">
<meta property="og:url" content="https://orangexc.xyz/2018/06/23/front-end-test/index.html">
<meta property="og:site_name" content="Orange&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://orangexc.xyz/uploads/front-end-test1.jpg">
<meta property="article:published_time" content="2018-06-23T10:50:56.000Z">
<meta property="article:modified_time" content="2020-03-07T04:36:18.011Z">
<meta property="article:author" content="Orange">
<meta property="article:tag" content="Test">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://orangexc.xyz/uploads/front-end-test1.jpg">


<link rel="canonical" href="https://orangexc.xyz/2018/06/23/front-end-test/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>浅谈前端测试 | Orange's Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Orange's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#node-%E7%8E%AF%E5%A2%83"><span class="nav-number">1.</span> <span class="nav-text">node 环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mock"><span class="nav-number">1.1.</span> <span class="nav-text">mock</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E7%94%A8%E5%A4%96%E9%83%A8%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.</span> <span class="nav-text">引用外部文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A6%86%E7%9B%96%E7%8E%87"><span class="nav-number">1.3.</span> <span class="nav-text">覆盖率</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vue-%E7%8E%AF%E5%A2%83"><span class="nav-number">2.</span> <span class="nav-text">vue 环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#unit-%E6%B5%8B%E8%AF%95"><span class="nav-number">2.1.</span> <span class="nav-text">unit 测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e2e-%E6%B5%8B%E8%AF%95"><span class="nav-number">2.2.</span> <span class="nav-text">e2e 测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nuxt-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E7%8E%AF%E5%A2%83"><span class="nav-number">3.</span> <span class="nav-text">nuxt 服务端渲染环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#unit-%E6%B5%8B%E8%AF%95-1"><span class="nav-number">3.1.</span> <span class="nav-text">unit 测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e2e-%E6%B5%8B%E8%AF%95-1"><span class="nav-number">3.2.</span> <span class="nav-text">e2e 测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#react-%E7%8E%AF%E5%A2%83"><span class="nav-number">4.</span> <span class="nav-text">react 环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#unit-%E6%B5%8B%E8%AF%95-2"><span class="nav-number">4.1.</span> <span class="nav-text">unit 测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e2e-%E6%B5%8B%E8%AF%95-2"><span class="nav-number">4.2.</span> <span class="nav-text">e2e 测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#next-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E7%8E%AF%E5%A2%83"><span class="nav-number">5.</span> <span class="nav-text">next 服务端渲染环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#unit-%E6%B5%8B%E8%AF%95-3"><span class="nav-number">5.1.</span> <span class="nav-text">unit 测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e2e-%E6%B5%8B%E8%AF%95-3"><span class="nav-number">5.2.</span> <span class="nav-text">e2e 测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#angular-%E7%8E%AF%E5%A2%83"><span class="nav-number">6.</span> <span class="nav-text">angular 环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">7.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Orange"
      src="/uploads/@avatar.jpg">
  <p class="site-author-name" itemprop="name">Orange</p>
  <div class="site-description" itemprop="description">Go big or go home</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/OrangeXC" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;OrangeXC" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/orangewxc" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;orangewxc" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:me@orangexc.xyz" title="E-Mail → mailto:me@orangexc.xyz"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://orangexc.xyz/2018/06/23/front-end-test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/@avatar.jpg">
      <meta itemprop="name" content="Orange">
      <meta itemprop="description" content="Go big or go home">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Orange's Blog">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          浅谈前端测试
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-06-23 18:50:56" itemprop="dateCreated datePublished" datetime="2018-06-23T18:50:56+08:00">2018-06-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><img src="/uploads/front-end-test1.jpg" alt=""></p>
<a id="more"></a>

<p>前端测试或许被好多人误解，也许大家更加倾向于编写面向后端的测试，逻辑性强，测试方便等</p>
<p>聊到这导致了好多前端从来不写测试（测试全靠手点～～～）</p>
<p>其实没必要达到测试驱动开发的程度，只要写完代码可以补测试，并且补出高效的测试，前端或许真的不需要手点</p>
<p>大前端时代不谈环境不成方圆，本文从下面几个环境一一分析下如何敏捷测试</p>
<ul>
<li>node 环境</li>
<li>vue 环境</li>
<li>nuxt 服务端渲染环境</li>
<li>react 环境</li>
<li>next 服务端渲染环境</li>
<li>angular 环境</li>
</ul>
<p>理解测试前需要补充下单元测试（unit）和端到端测试（e2e）的概念，这里不赘述</p>
<h2 id="node-环境"><a href="#node-环境" class="headerlink" title="node 环境"></a>node 环境</h2><p>推荐测试框架 <a href="https://facebook.github.io/jest/" target="_blank" rel="noopener">jest</a></p>
<p>jest 是 FB 的杰作之一，方便各种场景的 js 代码测试，这里选择 jest 是因为确实方便</p>
<p>使用方法及配置信息可以去官方文档</p>
<p>配置的注意事项</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  testEnvironment: <span class="string">'node'</span> <span class="comment">// 如不声明默认浏览器环境</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>针对 node 只聊一下单元测试，e2e 测试比较少见</p>
<p>当决定写一个 npm 模块时，代码完成后必不可少的就是单元测试，单元测试需要注意的问题比较琐碎</p>
<h3 id="mock"><a href="#mock" class="headerlink" title="mock"></a>mock</h3><p>当引入三方库时，不得不 mock 数据，因为单元测试更多讲求的是局部测试，不要受外界三方引入包的影响</p>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; readFileSync &#125; = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getFile = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> text = readFileSync(<span class="string">'text.txt'</span>, <span class="string">'utf8'</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = getFile</span><br></pre></td></tr></table></figure>

<p>这时我们并不需要关心 <code>text.txt</code> 是否真的存在，也不需要关系 <code>text</code> 的内容具体是什么，我们的关注点应该在于读取文件错误时能否及时抛出异常，以及 <code>console.log()</code> 是否如预期执行</p>
<p>对应到测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getFile = <span class="built_in">require</span>(<span class="string">'./getFile'</span>)</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'readFile'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> mocks = &#123;</span><br><span class="line">    fs: &#123;</span><br><span class="line">      readFileSync: jest.fn()</span><br><span class="line">    &#125;,</span><br><span class="line">    other: &#123;</span><br><span class="line">      text: <span class="string">'Test text'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  beforeAll(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    jest.mock(<span class="string">'fs'</span>, () =&gt; mocks.fs)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  test(<span class="string">'read file success run console.log'</span>, () =&gt; &#123;</span><br><span class="line">    mocks.fs.readFileSync.mockImplementation(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.mocks.other.text)</span><br><span class="line"></span><br><span class="line">    getFile()</span><br><span class="line"></span><br><span class="line">    expect(<span class="built_in">console</span>.log).toBeCalled()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上面代码简单的实现了一个读取文件是否成功的测试，先别急着纠错，这段测试本身是错的，下面慢慢分析</p>
<p>我们在最开始创建了一个 <code>mocks</code> 对象，用来模拟数据，由于 <code>readFileSync</code> 方法可能存在多种返回结果（成功或报错），所以暂时用 <code>jest.fn()</code> 模拟</p>
<p>other 里面则是放一些固定的测试数据（不会随着测试过程而改变）</p>
<p><code>beforeAll</code> 钩子里面执行我们的 mock，把 require 进来的 fs 模块拦截调，也是本测试用例中的关键步骤</p>
<p>在第一个 test 里面我们改写 <code>mocks.fs.readFileSync</code> 的返回形式，这里使用的 <code>mockImplementation</code> 是直接模拟了一个执行函数，当然也可以模拟返回值，具体可以到 jest 官网</p>
<p><code>expect</code> 用来断言我们的 <code>console.log</code> 方法执行了</p>
<p>解释了这么多测试新手们应该也都看的明白了，下面聊一下错在哪，怎么改进</p>
<ol>
<li><code>mockImplementation</code> 最好替换为 <code>mockReturnValueOnce</code>，注意这里出现了 Once 结尾，也就是仅模拟一次返回值，<code>mockImplementation</code> 最好使用在复杂场景，所谓的复杂就是我们手动实现一个 <code>readFileSync</code> 方法使得测试达到我们预期的目的，在这个简单的场景里面我们只需要模拟返回值就好</li>
<li><code>expect(console.log)</code> 这里会报错，因为 jest 断言的内容只能是 mock function 或 spy，这里 console 是全局对象 global 上的方法，我们没有 require 将其引入，所以 jest.mock 显然处理上有些吃力，这时候 spy 就派上用场了，<code>beforeAll</code> 钩子里直接执行 <code>jest.spyOn(global.console, &#39;log&#39;)</code>，接下来我们就能监听到 <code>console.log</code> 的执行了 <code>expect(global.console.log)</code></li>
<li>断言的目的是测试 <code>console.log</code> 的执行，这是不严谨的测试，我们需要使用 <code>toBeCalledWith</code> 来代替 <code>toBeCalled</code>，不仅要测试执行了，而且要测试参数正确，简单修改为 <code>expect(global.console.log).toBeCalledWith(this.mocks.other.text)</code></li>
</ol>
<p>下面补一下 read file 失败的测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'read file fail throw error'</span>, () =&gt; &#123;</span><br><span class="line">  mocks.fs.readFileSync.mockImplementationOnce(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'readFile error'</span>) &#125;)</span><br><span class="line"></span><br><span class="line">  expect(getFile()).toThrow()</span><br><span class="line">  expect(global.console.log).not.toBeCalled()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>读取文件失败的测试就好理解的多，注意的就是对一个 <code>jest.fn()</code> 多次进行修改会导致测试用例之间的相互影响，这里尽量使用 Once 结尾方法，复杂场景可以如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  mocks.fs.readFileSync.mockReset()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>每次执行 test 前先清除 mock，避免多个测试用例之间复杂化 mock 导致错误</p>
<blockquote>
<p>小结：单元测试中的 mock 是个测试思路，我们无需关心外部文件和依赖是什么，只要能模拟出正确的情况程序是否按规则执行，错误的情况程序是否有异常处理，逻辑是否正确等。这样就能排除外界干扰，使得我们测试的当前一小部分是可靠的，稳定的即可。</p>
</blockquote>
<h3 id="引用外部文件"><a href="#引用外部文件" class="headerlink" title="引用外部文件"></a>引用外部文件</h3><p>单拿出一个小结说下 require 的问题，node 9 之前不支持 es6 的 import，这里也不详细说明了。</p>
<p>require 本身并不复杂，但是如果搞不清楚执行时机，那么测试将无法进行，来一个例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> env = process.env.NODE_ENV</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.export = <span class="function"><span class="params">()</span> =&gt;</span> env</span><br></pre></td></tr></table></figure>

<p>测试如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getEnv = <span class="built_in">require</span>(<span class="string">'./getEnv'</span>)</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'env'</span>, () =&gt; &#123;</span><br><span class="line">  test(<span class="string">'env will be dev'</span>, () =&gt; &#123;</span><br><span class="line">    process.env.NODE_ENV = <span class="string">'dev'</span></span><br><span class="line"></span><br><span class="line">    expect(getEnv()).toBe(<span class="string">'dev'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  test(<span class="string">'env will be pord'</span>, () =&gt; &#123;</span><br><span class="line">    process.env.NODE_ENV = <span class="string">'pord'</span></span><br><span class="line"></span><br><span class="line">    expect(getEnv()).toBe(<span class="string">'pord'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>十分简单的测试，抛开了 mock 的流程，这里会报测试未通过，原因是 require 同时 env 已经被赋值为 <code>undefined</code>，我们再试着改变 <code>NODE_ENV</code> 环境变量时，程序不会再次执行，当然了，处理起来也十分简单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> getEnv</span><br><span class="line"></span><br><span class="line">test(<span class="string">'env will be dev'</span>, () =&gt; &#123;</span><br><span class="line">  process.env.NODE_ENV = <span class="string">'dev'</span></span><br><span class="line">  getEnv = <span class="built_in">require</span>(<span class="string">'./getEnv'</span>)</span><br><span class="line"></span><br><span class="line">  expect(getEnv()).toBe(<span class="string">'dev'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'env will be pord'</span>, () =&gt; &#123;</span><br><span class="line">  process.env.NODE_ENV = <span class="string">'pord'</span></span><br><span class="line">  getEnv = <span class="built_in">require</span>(<span class="string">'./getEnv'</span>)</span><br><span class="line"></span><br><span class="line">  expect(getEnv()).toBe(<span class="string">'pord'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>顺带说了一下，希望大家不要在这种低级错误上浪费时间</p>
<p>其实引用外部文件还有些场景会对测试带来困惑，比如动态路径，场景如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> packageFile = <span class="string">`<span class="subst">$&#123;process.cwd()&#125;</span>/package.json`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> package = <span class="built_in">require</span>(packageFile)</span><br></pre></td></tr></table></figure>

<p>读取当前路径下的 <code>package.json</code>，当测试真正跑到这段代码时会到当前目录下找 <code>package.json</code>，这里尽量 mock 掉 <code>package.json</code> 为我们自己的模拟数据，但是 jest 不支持动态路径的 mock，试着这样写 <code>jest.mock(</code>${process.cwd()}/package.json<code>, () =&gt; mockFile)</code> 会报错，所以尽量使用可以 mock 的方案，保证单元测试可以顺利进行，修改如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> filePath = path.join(process.cwd(), <span class="string">'package.json'</span>)</span><br></pre></td></tr></table></figure>

<p>这样就可以 mock，<code>path</code> 了，和上面 mock 章节，大致思想都差不多</p>
<h3 id="覆盖率"><a href="#覆盖率" class="headerlink" title="覆盖率"></a>覆盖率</h3><p>单元测试覆盖率不达标等于白测，测试过程尽量覆盖所有判断条件，而不是全部通过了就不管了，在进一阶说，100% 的测试覆盖率并不证明一定覆盖到位了，因为顺带执行的代码也会算进覆盖率，例如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.export = <span class="function">(<span class="params">list</span>) =&gt;</span> list.map(<span class="function">(<span class="params">&#123; id &#125;</span>) =&gt;</span> id)</span><br></pre></td></tr></table></figure>

<p>我们先不考虑这个 list 类型是不是数组，只是简单的例子，避免过度设计带来复杂化，我们测试可以这样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getId = <span class="built_in">require</span>(<span class="string">'./getId'</span>)</span><br><span class="line"><span class="keyword">const</span> mocks = &#123;</span><br><span class="line">  list: [&#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    name: <span class="string">'vue'</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    name: <span class="string">'react'</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'return id'</span>, () =&gt; &#123;</span><br><span class="line">  expect(getId(mocks.list)).toEqual([<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>直到有一天代码变成了 <code>module.export = (list) =&gt; [1, 2]</code></p>
<p>这时候测试还能通过，并且覆盖率 100%，的确不会有人蠢到把代码改成这样，只是一个例子，实际上逻辑会比这个复杂的多</p>
<p>那就聊一聊解决方案</p>
<ul>
<li>mock 数据的随机化，每次测试生成随机的 list 进行测试，现有库 <a href="https://github.com/nuysoft/Mock/wiki/Getting-Started" target="_blank" rel="noopener">mockjs</a></li>
<li>强关联测试，证明 map 方法的确执行了，并且参数正确，先 spy <code>spyOn(Array.prototype, &#39;map&#39;)</code> 然后断言</li>
</ul>
<p>聊了一圈从覆盖率聊到了测试健壮性的问题，可以思考下写过的测试是否真的满足注释或修改任何一行代码都能引起测试的 pass 报错</p>
<p>关于 node 就聊这么多，其实下文主要思想都一样，更多的是介绍些简单可行的方案，以及可能会踩坑的地方</p>
<h2 id="vue-环境"><a href="#vue-环境" class="headerlink" title="vue 环境"></a>vue 环境</h2><p>在 vue 使用场景下，无非就是组件库和业务逻辑，组件库偏向于 unit 测试，业务逻辑偏向于 e2e 测试，当然两者并不冲突</p>
<h3 id="unit-测试"><a href="#unit-测试" class="headerlink" title="unit 测试"></a>unit 测试</h3><p>推荐神器：<a href="https://github.com/vuejs/vue-test-utils" target="_blank" rel="noopener">vue-test-utils</a></p>
<p>README 给了多个测试库配置的例子，这里还是推荐使用 jest，给个例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  props: [<span class="string">'value'</span>],</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      currentValue: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    value (val) &#123;</span><br><span class="line">      <span class="keyword">this</span>.currentValue = val</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">'@vue/test-utils'</span></span><br><span class="line"><span class="keyword">import</span> Test <span class="keyword">from</span> <span class="string">'./Test.vue'</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'props value'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> options = &#123; <span class="attr">propsData</span>: &#123; <span class="attr">value</span>: <span class="number">3</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> wrapper = mount(Test)</span><br><span class="line"></span><br><span class="line">  expect(wrapper.vm.currentValue).toBe(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>十分简单的例子，亮点在测试文件的 wrapper 上，通过 <code>mount</code> 方法创建了一个组件实例，创建过程中允许加入一些配置信息，甚至是 mock 组件中的 method 方法</p>
<p>vue 单元测试的范围仅限于数据流动是否正确，逻辑渲染是否正确（v-if v-show v-for），style 和 class 是否正确，我们并不需要关系这个组件在浏览器渲染中的位置，也不需要关系对其它组件会造成什么影响，只要保证组件本身正确即可，前面说的断言，vue-test-utils 都能提供对应的方案，总体上节约很多测试成本</p>
<h3 id="e2e-测试"><a href="#e2e-测试" class="headerlink" title="e2e 测试"></a>e2e 测试</h3><p>也是推荐尤大基于最新脚手架的 <a href="https://www.npmjs.com/package/@vue/cli-plugin-e2e-nightwatch" target="_blank" rel="noopener">@vue/cli-plugin-e2e-nightwatch</a></p>
<p>e2e 测试的重点在于判断真实 DOM 是否满足预期要求，甚至很少出现 mock 场景，不可或缺的是一个浏览器运行环境，具体细节不赘述，可以看官方文档。</p>
<h2 id="nuxt-服务端渲染环境"><a href="#nuxt-服务端渲染环境" class="headerlink" title="nuxt 服务端渲染环境"></a>nuxt 服务端渲染环境</h2><p>nuxt 官方推荐 <a href="https://github.com/avajs/ava" target="_blank" rel="noopener">ava</a>，顺势带出 ava 的方案</p>
<h3 id="unit-测试-1"><a href="#unit-测试-1" class="headerlink" title="unit 测试"></a>unit 测试</h3><p>麻烦在配置上面，先给出需要安装的依赖</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"@vue/test-utils"</span>,</span><br><span class="line"><span class="string">"ava"</span>,</span><br><span class="line"><span class="string">"browser-env"</span>,</span><br><span class="line"><span class="string">"require-extension-hooks"</span>,</span><br><span class="line"><span class="string">"require-extension-hooks-babel"</span>,</span><br><span class="line"><span class="string">"require-extension-hooks-vue"</span>,</span><br><span class="line"><span class="string">"sinon"</span></span><br></pre></td></tr></table></figure>

<p>在 package.json 里加几行 ava 配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"ava"</span>: &#123;</span><br><span class="line">  <span class="string">"require"</span>: [</span><br><span class="line">    <span class="string">"./tests/helpers/setup.js"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面来写 <code>./tests/helpers/setup.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hooks = <span class="built_in">require</span>(<span class="string">'require-extension-hooks'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Setup browser environment</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'browser-env'</span>)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Setup vue files to be processed by `require-extension-hooks-vue`</span></span><br><span class="line">hooks(<span class="string">'vue'</span>).plugin(<span class="string">'vue'</span>).push()</span><br><span class="line"><span class="comment">// Setup vue and js files to be processed by `require-extension-hooks-babel`</span></span><br><span class="line">hooks([<span class="string">'vue'</span>, <span class="string">'js'</span>]).plugin(<span class="string">'babel'</span>).push()</span><br></pre></td></tr></table></figure>

<p>上面的代码唯独没看到 <code>sinon</code> 这个库，说到 ava 是没有 mock 功能的，这就给单元测试的 mock 带来巨大困难，不过我们可以通过引入 <code>sinon</code> 来解决 mock 数据的问题，在 mock 方面上 <code>sinon</code> 做的比 jest 还要优秀，支持沙箱模式，不影响外部数据</p>
<p>给个简单点的例子</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">v-for</span>=<span class="string">"item in topicList"</span> <span class="attr">:key</span>=<span class="string">"item.id"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card-content"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"link"</span> @<span class="attr">click</span>=<span class="string">"toMember(item.member.username)"</span>&gt;</span>&#123;&#123; item.member.username &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  props: &#123;</span><br><span class="line">    topicList: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Array</span>,</span></span><br><span class="line"><span class="actionscript">      required: <span class="literal">true</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    toMember (name) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$router.push(<span class="string">`/member/<span class="subst">$&#123;name&#125;</span>`</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对应的测试代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shallowMount &#125; <span class="keyword">from</span> <span class="string">'@vue/test-utils'</span></span><br><span class="line"><span class="keyword">import</span> test <span class="keyword">from</span> <span class="string">'ava'</span></span><br><span class="line"><span class="keyword">import</span> sinon <span class="keyword">from</span> <span class="string">'sinon'</span></span><br><span class="line"></span><br><span class="line">test(<span class="string">'methods: toMember'</span>, t =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; topicList &#125; = t.context</span><br><span class="line">  <span class="keyword">const</span> $router = &#123;</span><br><span class="line">    push: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> spy = sinon.spy($router, <span class="string">'push'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> wrapper = shallowMount(TopicListChalk, &#123;</span><br><span class="line">    propsData: &#123; topicList &#125;,</span><br><span class="line">    mocks: &#123;</span><br><span class="line">      $router</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  topicList.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> toMemberText = wrapper.findAll(<span class="string">'.card-content'</span>).at(index).find(<span class="string">'.link'</span>)</span><br><span class="line"></span><br><span class="line">    toMemberText.trigger(<span class="string">'click'</span>)</span><br><span class="line"></span><br><span class="line">    t.true(spy.withArgs(<span class="string">`/member/<span class="subst">$&#123;item.member.username&#125;</span>`</span>).calledOnce)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这里直接将 <code>$router</code> mock 掉，并且使用 <code>sinon.spy</code> 监听执行，至于 <code>this.$router.push</code> 后浏览器有没有跳转并不是单元测试需要关心的，这里的写法也比较特别，test 方法在回调里默认参数为 <code>t</code>，对应的方法都挂载在 <code>t</code> 对象上，上下文可通过 <code>t.context</code> 传递</p>
<p>nuxt 单元测试相关就聊这么多</p>
<h3 id="e2e-测试-1"><a href="#e2e-测试-1" class="headerlink" title="e2e 测试"></a>e2e 测试</h3><p>这里有个歧义点，nuxt 官网只给出了 e2e 的测试案例 <a href="https://nuxtjs.org/guide/development-tools#end-to-end-testing" target="_blank" rel="noopener">end-to-end-testing</a></p>
<p>当使用默认脚手架构建的项目，也就是没有 server 端入口文件的项目，这个方案确实可行</p>
<p>但是涉及到其它框架（express|koa）的时候就显得不够用了，很有可能在自定义 server 入口是加入了大量中间件，这对于官网给出的例子是个巨大考验，不可能在每个测试文件里实现一遍 <code>new Nuxt</code>，所以需要更高层的封装，也就是忽略 server 启动流程的差异性，直接在浏览器中抓取页面</p>
<p>推荐：<a href="https://github.com/studbits/nuxt-jest-puppeteer" target="_blank" rel="noopener">nuxt-jest-puppeteer</a></p>
<h2 id="react-环境"><a href="#react-环境" class="headerlink" title="react 环境"></a>react 环境</h2><h3 id="unit-测试-2"><a href="#unit-测试-2" class="headerlink" title="unit 测试"></a>unit 测试</h3><p>这一波没得可选，jest 完胜，人家官网就有 <a href="https://facebook.github.io/jest/docs/en/tutorial-react.html" target="_blank" rel="noopener">React，RN 的支持文档</a></p>
<p>文档的案例也是十分全面，没得讲，不赘述</p>
<h3 id="e2e-测试-2"><a href="#e2e-测试-2" class="headerlink" title="e2e 测试"></a>e2e 测试</h3><p>其实上面讲了两个 e2e 的方案选择，大同小异，需要一个能在 node 跑的无头浏览器，官方没有推荐，这里站 vue 一票选择 <a href="http://nightwatchjs.org/" target="_blank" rel="noopener">nightwatchjs</a></p>
<h2 id="next-服务端渲染环境"><a href="#next-服务端渲染环境" class="headerlink" title="next 服务端渲染环境"></a>next 服务端渲染环境</h2><h3 id="unit-测试-3"><a href="#unit-测试-3" class="headerlink" title="unit 测试"></a>unit 测试</h3><p>主要讲一下如何配置，先是依赖包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"babel-core"</span>,</span><br><span class="line"><span class="string">"babel-jest"</span>,</span><br><span class="line"><span class="string">"enzyme"</span>,</span><br><span class="line"><span class="string">"enzyme-adapter-react-16"</span>,</span><br><span class="line"><span class="string">"jest"</span>,</span><br><span class="line"><span class="string">"react-addons-test-utils"</span>,</span><br><span class="line"><span class="string">"react-test-renderer"</span></span><br></pre></td></tr></table></figure>

<p>在 package.json 里面加 script <code>&quot;test&quot;: &quot;NODE_ENV=test jest&quot;</code></p>
<p>在跟路径下加 jest.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  setupFiles: [<span class="string">'&lt;rootDir&gt;/jest.setup.js'</span>],</span><br><span class="line">  testPathIgnorePatterns: [<span class="string">'&lt;rootDir&gt;/.next/'</span>, <span class="string">'&lt;rootDir&gt;/node_modules/'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在跟路径下加 jest.setup.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span></span><br><span class="line"><span class="keyword">import</span> Adapter <span class="keyword">from</span> <span class="string">'enzyme-adapter-react-16'</span></span><br><span class="line"></span><br><span class="line">configure(&#123;</span><br><span class="line">  adapter: <span class="keyword">new</span> Adapter()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>接下来就可以愉快的写测试了</p>
<h3 id="e2e-测试-3"><a href="#e2e-测试-3" class="headerlink" title="e2e 测试"></a>e2e 测试</h3><p>跳过了～～～</p>
<h2 id="angular-环境"><a href="#angular-环境" class="headerlink" title="angular 环境"></a>angular 环境</h2><p>之所以加了这一节，还是因为多少写过一些 angular，angular 作为框架本身就是全面的，cli 新建的项目自身就带有 unit 测试和 e2e 测试</p>
<p>unit 测试默认是 <a href="https://karma-runner.github.io/2.0/index.html" target="_blank" rel="noopener">karma</a> + <a href="https://jasmine.github.io/" target="_blank" rel="noopener">jasmine</a><br>e2e 测试默认是 <a href="https://www.protractortest.org/#/" target="_blank" rel="noopener">protractor</a></p>
<p>也没什么可争辩的，这就是官方解决方案，用起来也方便顺手</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>聊了好多个环境，其实行文目的主要有两方面</p>
<ul>
<li>测试思想，如何写好单元测试，主要集中在前半文</li>
<li>测试工具推荐和相应配置</li>
</ul>
<p>测试本身并不复杂，但是想写出高效测试并不容易，千万不要形成为了测试而测试的想法</p>
<blockquote>
<p>用谎言去验证谎言得到的还是谎言。。。</p>
</blockquote>
<p>大多数情况下都是项目在赶进度没空写测试，抽空把测试补上真的是一件值得去做的事情</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Test/" rel="tag"># Test</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2018/05/10/angular6-udao-ssr/" rel="prev" title="Angular 6 服务端渲染之 udao 终章">
                  <i class="fa fa-chevron-left"></i> Angular 6 服务端渲染之 udao 终章
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2018/08/07/vue-hotzone/" rel="next" title="Vue 实现热区图">
                  Vue 实现热区图 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Orange</span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  <script src="/js/local-search.js"></script>















  








  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.css">

<script>
NexT.utils.loadComments('#gitalk-container', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'eb2068e9455b70ca891b',
      clientSecret: '61b36e1b37fda850dea7e3ed24c67df073165234',
      repo        : 'orangexc.github.io',
      owner       : 'OrangeXC',
      admin       : ['OrangeXC'],
      id          : 'af7c51a36caf7fdd2c3a0f0b0d4254fa',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
